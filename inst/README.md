
<!-- README.md is generated from README.Rmd. Please edit that file -->

# Example data

## Origin

The `viralprod` package provides example data located in the `extdata`
folder. This data originates from seawater samples collected at
Marsdiep, the Netherlands, during incoming high tides. We collected
samples from seven different stations, but due to memory constraints of
the R package, only data from two stations is included. Specifically,
seawater samples from Station 2 were retrieved on August 6, 2020, and
from Station 6 on September 3, 2020, both during incoming high tides.

![General Map](man/Figures/README-map.png) ![Satellite
Map](man/Figures/README-map-satellite.png)

The samples underwent a viral reduction assay, and we obtained viral and
bacterial counts using a flow cytometer with the SYBR GREEN I dye. For
Station 2 the measurement was conducted on November 3, 2020, and for
Station 6, it took place on November 12, 2020.

Detailed information about the viral reduction assay and the
construction of the count data with the flow cytometer can be found in
the `package's vignette`.

## Exploring the data

Inside the `extdata` folder, a total of five CSV files can be found:

- One of these files contains the original abundances.
- The other four contain data from the flow cytometry step. All four
  contain the same information but differ in the gating process.

The gating process allows users to choose which gates to draw and how
many, introducing variability in data analysis. The different data sets
are included to demonstrate that the package works independently of the
gating process, showcasing its versatility and adaptability to user
preferences.

Now, letâ€™s explore the data files. Please note that we assume that the
`viralprod` package is already installed. If not, see the
`main README file`.

Load the package:

``` r
library(viralprod)
```

List of the data files:

``` r
list.files(path = system.file("extdata", package = "viralprod"), pattern = "\\.csv$", full.names = FALSE)
#> [1] "NJ2020_original_abundances.csv"             
#> [2] "NJ2020_Station_2_and_6_all_populations.csv" 
#> [3] "NJ2020_Station_2_and_6_less_populations.csv"
#> [4] "NJ2020_Station_2_and_6_more_populations.csv"
#> [5] "NJ2020_Station_2_and_6_without_cViruses.csv"
```

The `viralprod` package relies on **two** data files:

- Count data from the flow cytometer
- Original abundance of seawater sample

Some small requirements on both are necessary to assure the working of
the package. In the package, there are two functions which check if the
input data frames have the correct structure by adding an S3 class to it
if so. The functions inside the package will only work if the input data
frames have this specific S3 class.

First, take a look at the original abundances file. This file contains
the viral and bacterial counts of the original seawater sample.

``` r
NJ2020_original_abundances <- read.csv(system.file('extdata','NJ2020_original_abundances.csv', package = "viralprod"))
NJ2020_original_abundances
#>   ...1 Location Bacterial_Sample_Name Viral_Sample_Name Station_Number
#> 1    1   NJ2020          BA210507.066      VI210507.067              1
#> 2    2   NJ2020          BA210507.067      VI210507.068              2
#> 3    3   NJ2020          BA210507.068      VI210507.069              3
#> 4    4   NJ2020          ba201028.015      vi201028.008              4
#> 5    5   NJ2020          BA210507.069      VI210507.070              5
#> 6    6   NJ2020          BA210507.070      VI210507.071              6
#> 7    7   NJ2020          BA210507.071      VI210507.072              7
#>   Expt_Date Total_Bacteria     HNA     LNA Total_Viruses        V1       V2
#> 1  04-08-20        3454942 1993730 1461212     182285832 140810685 33328040
#> 2  06-08-20        3231054 2038118 1192936     204686985 161552701 34950478
#> 3  18-08-20        6665980 3740874 2925106     226495058 191800795 26766127
#> 4  20-08-20        8163509 3911664 4251845     183418451 153581030 22152025
#> 5  01-09-20        3297776 1775346 1522430     137359967 111715891 22360925
#> 6  03-09-20        4702883 2332421 2370463     153088962 122845569 25154253
#> 7  05-09-20        3599259 1837173 1762086     133369028 107261386 22336907
#>        V3      VBR Latitude Longitude
#> 1 8147107 52.76089 53.00177  4.789015
#> 2 8183806 63.34990 53.00177  4.789015
#> 3 7928136 33.97776 53.00177  4.789015
#> 4 7685396 22.46809 53.00177  4.789015
#> 5 3283152 41.65230 53.00177  4.789015
#> 6 5089140 32.55215 53.00177  4.789015
#> 7 3770735 37.05458 53.00177  4.789015
```

``` r
str(NJ2020_original_abundances)
#> 'data.frame':    7 obs. of  16 variables:
#>  $ ...1                 : int  1 2 3 4 5 6 7
#>  $ Location             : chr  "NJ2020" "NJ2020" "NJ2020" "NJ2020" ...
#>  $ Bacterial_Sample_Name: chr  "BA210507.066" "BA210507.067" "BA210507.068" "ba201028.015" ...
#>  $ Viral_Sample_Name    : chr  "VI210507.067" "VI210507.068" "VI210507.069" "vi201028.008" ...
#>  $ Station_Number       : int  1 2 3 4 5 6 7
#>  $ Expt_Date            : chr  "04-08-20" "06-08-20" "18-08-20" "20-08-20" ...
#>  $ Total_Bacteria       : num  3454942 3231054 6665980 8163509 3297776 ...
#>  $ HNA                  : num  1993730 2038118 3740874 3911664 1775346 ...
#>  $ LNA                  : num  1461212 1192936 2925106 4251845 1522430 ...
#>  $ Total_Viruses        : num  1.82e+08 2.05e+08 2.26e+08 1.83e+08 1.37e+08 ...
#>  $ V1                   : num  1.41e+08 1.62e+08 1.92e+08 1.54e+08 1.12e+08 ...
#>  $ V2                   : num  33328040 34950478 26766127 22152025 22360925 ...
#>  $ V3                   : num  8147107 8183806 7928136 7685396 3283152 ...
#>  $ VBR                  : num  52.8 63.3 34 22.5 41.7 ...
#>  $ Latitude             : num  53 53 53 53 53 ...
#>  $ Longitude            : num  4.79 4.79 4.79 4.79 4.79 ...
```

For the original abundance file, it is important that a data frame is
constructed with at least the following three columns:

- *Station_Number*: An integer value referring to the station where the
  seawater samples were taken from.
- *Total_Bacteria*: Numeric values representing the abundance of total
  bacteria in the original seawater sample for each station.
- *Total_Viruses*: Numeric values representing the abundance of total
  viruses in the original seawater sample for each station.

Below, an example on how to check your original abundance file:

``` r
good_dataframe <- NJ2020_original_abundances
str(good_dataframe)
#> 'data.frame':    7 obs. of  16 variables:
#>  $ ...1                 : int  1 2 3 4 5 6 7
#>  $ Location             : chr  "NJ2020" "NJ2020" "NJ2020" "NJ2020" ...
#>  $ Bacterial_Sample_Name: chr  "BA210507.066" "BA210507.067" "BA210507.068" "ba201028.015" ...
#>  $ Viral_Sample_Name    : chr  "VI210507.067" "VI210507.068" "VI210507.069" "vi201028.008" ...
#>  $ Station_Number       : int  1 2 3 4 5 6 7
#>  $ Expt_Date            : chr  "04-08-20" "06-08-20" "18-08-20" "20-08-20" ...
#>  $ Total_Bacteria       : num  3454942 3231054 6665980 8163509 3297776 ...
#>  $ HNA                  : num  1993730 2038118 3740874 3911664 1775346 ...
#>  $ LNA                  : num  1461212 1192936 2925106 4251845 1522430 ...
#>  $ Total_Viruses        : num  1.82e+08 2.05e+08 2.26e+08 1.83e+08 1.37e+08 ...
#>  $ V1                   : num  1.41e+08 1.62e+08 1.92e+08 1.54e+08 1.12e+08 ...
#>  $ V2                   : num  33328040 34950478 26766127 22152025 22360925 ...
#>  $ V3                   : num  8147107 8183806 7928136 7685396 3283152 ...
#>  $ VBR                  : num  52.8 63.3 34 22.5 41.7 ...
#>  $ Latitude             : num  53 53 53 53 53 ...
#>  $ Longitude            : num  4.79 4.79 4.79 4.79 4.79 ...
```

``` r
df <- new_viralprod_class_2(good_dataframe)
class(df)
#> [1] "viralprod_analyze" "data.frame"
```

``` r
bad_dataframe <- dplyr::mutate(dplyr::select(NJ2020_original_abundances, -'Station_Number'), Total_Bacteria = as.character(Total_Bacteria))
str(bad_dataframe)
#> 'data.frame':    7 obs. of  15 variables:
#>  $ ...1                 : int  1 2 3 4 5 6 7
#>  $ Location             : chr  "NJ2020" "NJ2020" "NJ2020" "NJ2020" ...
#>  $ Bacterial_Sample_Name: chr  "BA210507.066" "BA210507.067" "BA210507.068" "ba201028.015" ...
#>  $ Viral_Sample_Name    : chr  "VI210507.067" "VI210507.068" "VI210507.069" "vi201028.008" ...
#>  $ Expt_Date            : chr  "04-08-20" "06-08-20" "18-08-20" "20-08-20" ...
#>  $ Total_Bacteria       : chr  "3454942.339" "3231054.366" "6665980.231" "8163509.061" ...
#>  $ HNA                  : num  1993730 2038118 3740874 3911664 1775346 ...
#>  $ LNA                  : num  1461212 1192936 2925106 4251845 1522430 ...
#>  $ Total_Viruses        : num  1.82e+08 2.05e+08 2.26e+08 1.83e+08 1.37e+08 ...
#>  $ V1                   : num  1.41e+08 1.62e+08 1.92e+08 1.54e+08 1.12e+08 ...
#>  $ V2                   : num  33328040 34950478 26766127 22152025 22360925 ...
#>  $ V3                   : num  8147107 8183806 7928136 7685396 3283152 ...
#>  $ VBR                  : num  52.8 63.3 34 22.5 41.7 ...
#>  $ Latitude             : num  53 53 53 53 53 ...
#>  $ Longitude            : num  4.79 4.79 4.79 4.79 4.79 ...
```

``` r
df <- new_viralprod_class_2(bad_dataframe)
#> Error in new_viralprod_class_2(bad_dataframe): Assertion on 'has_correct_columns' failed: Must be TRUE.
class(bad_dataframe)
#> [1] "data.frame"
```

Similar checks can be performed for the other four count data files:

``` r
NJ2020_all <- read.csv(system.file('extdata','NJ2020_Station_2_and_6_all_populations.csv', package = "viralprod"))
NJ2020_less <- read.csv(system.file('extdata','NJ2020_Station_2_and_6_less_populations.csv', package = "viralprod"))
NJ2020_more <- read.csv(system.file('extdata','NJ2020_Station_2_and_6_more_populations.csv', package = "viralprod"))
NJ2020_without_cViruses <- read.csv(system.file('extdata','NJ2020_Station_2_and_6_without_cViruses.csv', package = "viralprod"))

head(NJ2020_all)
#>    Sample_Name Staining_Protocol Expt_Date Date_Measurement Location
#> 1 vi201103.011           Viruses  06-08-20         03-11-20   NJ2020
#> 2 vi201103.027           Viruses  06-08-20         03-11-20   NJ2020
#> 3 vi201104.009           Viruses  06-08-20         03-11-20   NJ2020
#> 4 vi201103.013           Viruses  06-08-20         03-11-20   NJ2020
#> 5 vi201103.028           Viruses  06-08-20         03-11-20   NJ2020
#> 6 vi201104.010           Viruses  06-08-20         03-11-20   NJ2020
#>   Station_Number Depth Sample_Type Timepoint Replicate c_Bacteria       c_HNA
#> 1              2     1        0.22         0         1   2302.772    657.9348
#> 2              2     1          VP         0         1 902558.635 485109.3090
#> 3              2     1         VPC         0         1 825159.915 467213.8330
#> 4              2     1        0.22         0         2   2302.772    328.9674
#> 5              2     1          VP         0         2 857782.516 513137.7551
#> 6              2     1         VPC         0         2 770149.254 451553.3084
#>        c_LNA c_Viruses     c_V1    c_V2      c_V3        VBR HNAperLNA ...20
#> 1   1644.837  12126652 10474610 1558655  93387.35 5266.11111 0.4000000    NA
#> 2 417449.326  33939019 28626527 4623201 689291.12   37.60312 1.1620795    NA
#> 3 357946.082  36735608 31173468 4822708 739431.39   44.51938 1.3052632    NA
#> 4   1973.804  12777569 10998408 1675073 104089.08 5548.77778 0.1666667    NA
#> 5 344644.761  34344563 28800531 4845791 698240.85   40.03878 1.4888889    NA
#> 6 318595.945  34180810 28994948 4534163 651699.32   44.38206 1.4173228    NA
#>   ...21 ...22 ...23 ...24 ...25 ...26 ...27 ...28 ...29 ...30 ...31
#> 1    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
#> 2    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
#> 3    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
#> 4    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
#> 5    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
#> 6    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
```

``` r
str(NJ2020_all)
#> 'data.frame':    84 obs. of  31 variables:
#>  $ Sample_Name      : chr  "vi201103.011" "vi201103.027" "vi201104.009" "vi201103.013" ...
#>  $ Staining_Protocol: chr  "Viruses" "Viruses" "Viruses" "Viruses" ...
#>  $ Expt_Date        : chr  "06-08-20" "06-08-20" "06-08-20" "06-08-20" ...
#>  $ Date_Measurement : chr  "03-11-20" "03-11-20" "03-11-20" "03-11-20" ...
#>  $ Location         : chr  "NJ2020" "NJ2020" "NJ2020" "NJ2020" ...
#>  $ Station_Number   : int  2 2 2 2 2 2 2 2 2 2 ...
#>  $ Depth            : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ Sample_Type      : chr  "0.22" "VP" "VPC" "0.22" ...
#>  $ Timepoint        : num  0 0 0 0 0 0 0 0 0 3 ...
#>  $ Replicate        : int  1 1 1 2 2 2 3 3 3 1 ...
#>  $ c_Bacteria       : num  2303 902559 825160 2303 857783 ...
#>  $ c_HNA            : num  658 485109 467214 329 513138 ...
#>  $ c_LNA            : num  1645 417449 357946 1974 344645 ...
#>  $ c_Viruses        : num  12126652 33939019 36735608 12777569 34344563 ...
#>  $ c_V1             : num  10474610 28626527 31173468 10998408 28800531 ...
#>  $ c_V2             : num  1558655 4623201 4822708 1675073 4845791 ...
#>  $ c_V3             : num  93387 689291 739431 104089 698241 ...
#>  $ VBR              : num  5266.1 37.6 44.5 5548.8 40 ...
#>  $ HNAperLNA        : num  0.4 1.162 1.305 0.167 1.489 ...
#>  $ ...20            : logi  NA NA NA NA NA NA ...
#>  $ ...21            : logi  NA NA NA NA NA NA ...
#>  $ ...22            : logi  NA NA NA NA NA NA ...
#>  $ ...23            : logi  NA NA NA NA NA NA ...
#>  $ ...24            : logi  NA NA NA NA NA NA ...
#>  $ ...25            : logi  NA NA NA NA NA NA ...
#>  $ ...26            : logi  NA NA NA NA NA NA ...
#>  $ ...27            : logi  NA NA NA NA NA NA ...
#>  $ ...28            : logi  NA NA NA NA NA NA ...
#>  $ ...29            : logi  NA NA NA NA NA NA ...
#>  $ ...30            : logi  NA NA NA NA NA NA ...
#>  $ ...31            : logi  NA NA NA NA NA NA ...
```

For this data file, the following columns need to be presented within
the data:

- Character columns *Location* and *Sample_Type*: Referring to the
  sample location and sample type.
- Integer columns *Station_Number*, *Depth* and *Replicate*:
  Representing the station number, sampling depth and replicate of the
  sample.
- Numeric column *Timepoint*: Referring to the timepoint of the assay of
  subsampling.

Additionally, based on the gating process, different numeric columns
with each of the gated populations should also be presented. The
`viralprod` package has a function that checks which populations need to
be analyzed. The function returns a message saying which populations
will be analyzed and a vector in the global environment with those
columns.

**Important note**: Column names for the gated process should start with
`c_` the total virus populations should be gated as `c_Viruses` and
subpopulations of viruses should be gated as `c_V...`.

``` r
vp_check_populations(NJ2020_all)
#> Following populations will be analyzed: c_Bacteria, c_HNA, c_LNA, c_Viruses, c_V1, c_V2, c_V3
vp_check_populations(NJ2020_less)
#> Following populations will be analyzed: c_Bacteria, c_Viruses
vp_check_populations(NJ2020_more)
#> Following populations will be analyzed: c_Bacteria, c_HNA, c_LNA, c_Viruses, c_V1, c_V2, c_V3, c_V4, c_V5
vp_check_populations(NJ2020_without_cViruses)
#> Error in vp_check_populations(NJ2020_without_cViruses): Total virus population, column c_Viruses, is not gated in output data frame of flow cytometry. Not able to perform viral production calculation!
```

Just like for the original abundance file, `viralprod` has a function
that will add a S3 class to the count data frames if they fulfill all
the requirements:

``` r
good_dataframe <- NJ2020_all
str(good_dataframe)
#> 'data.frame':    84 obs. of  31 variables:
#>  $ Sample_Name      : chr  "vi201103.011" "vi201103.027" "vi201104.009" "vi201103.013" ...
#>  $ Staining_Protocol: chr  "Viruses" "Viruses" "Viruses" "Viruses" ...
#>  $ Expt_Date        : chr  "06-08-20" "06-08-20" "06-08-20" "06-08-20" ...
#>  $ Date_Measurement : chr  "03-11-20" "03-11-20" "03-11-20" "03-11-20" ...
#>  $ Location         : chr  "NJ2020" "NJ2020" "NJ2020" "NJ2020" ...
#>  $ Station_Number   : int  2 2 2 2 2 2 2 2 2 2 ...
#>  $ Depth            : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ Sample_Type      : chr  "0.22" "VP" "VPC" "0.22" ...
#>  $ Timepoint        : num  0 0 0 0 0 0 0 0 0 3 ...
#>  $ Replicate        : int  1 1 1 2 2 2 3 3 3 1 ...
#>  $ c_Bacteria       : num  2303 902559 825160 2303 857783 ...
#>  $ c_HNA            : num  658 485109 467214 329 513138 ...
#>  $ c_LNA            : num  1645 417449 357946 1974 344645 ...
#>  $ c_Viruses        : num  12126652 33939019 36735608 12777569 34344563 ...
#>  $ c_V1             : num  10474610 28626527 31173468 10998408 28800531 ...
#>  $ c_V2             : num  1558655 4623201 4822708 1675073 4845791 ...
#>  $ c_V3             : num  93387 689291 739431 104089 698241 ...
#>  $ VBR              : num  5266.1 37.6 44.5 5548.8 40 ...
#>  $ HNAperLNA        : num  0.4 1.162 1.305 0.167 1.489 ...
#>  $ ...20            : logi  NA NA NA NA NA NA ...
#>  $ ...21            : logi  NA NA NA NA NA NA ...
#>  $ ...22            : logi  NA NA NA NA NA NA ...
#>  $ ...23            : logi  NA NA NA NA NA NA ...
#>  $ ...24            : logi  NA NA NA NA NA NA ...
#>  $ ...25            : logi  NA NA NA NA NA NA ...
#>  $ ...26            : logi  NA NA NA NA NA NA ...
#>  $ ...27            : logi  NA NA NA NA NA NA ...
#>  $ ...28            : logi  NA NA NA NA NA NA ...
#>  $ ...29            : logi  NA NA NA NA NA NA ...
#>  $ ...30            : logi  NA NA NA NA NA NA ...
#>  $ ...31            : logi  NA NA NA NA NA NA ...
```

``` r
df <- new_viralprod_class(good_dataframe)
#> Following populations will be analyzed: c_Bacteria, c_HNA, c_LNA, c_Viruses, c_V1, c_V2, c_V3
class(df)
#> [1] "viralprod"  "data.frame"
```

``` r
bad_dataframe <- dplyr::mutate(dplyr::select(NJ2020_all, -dplyr::all_of(c('Location', 'Replicate'))), Timepoint = as.character(Timepoint))
str(bad_dataframe)
#> 'data.frame':    84 obs. of  29 variables:
#>  $ Sample_Name      : chr  "vi201103.011" "vi201103.027" "vi201104.009" "vi201103.013" ...
#>  $ Staining_Protocol: chr  "Viruses" "Viruses" "Viruses" "Viruses" ...
#>  $ Expt_Date        : chr  "06-08-20" "06-08-20" "06-08-20" "06-08-20" ...
#>  $ Date_Measurement : chr  "03-11-20" "03-11-20" "03-11-20" "03-11-20" ...
#>  $ Station_Number   : int  2 2 2 2 2 2 2 2 2 2 ...
#>  $ Depth            : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ Sample_Type      : chr  "0.22" "VP" "VPC" "0.22" ...
#>  $ Timepoint        : chr  "0" "0" "0" "0" ...
#>  $ c_Bacteria       : num  2303 902559 825160 2303 857783 ...
#>  $ c_HNA            : num  658 485109 467214 329 513138 ...
#>  $ c_LNA            : num  1645 417449 357946 1974 344645 ...
#>  $ c_Viruses        : num  12126652 33939019 36735608 12777569 34344563 ...
#>  $ c_V1             : num  10474610 28626527 31173468 10998408 28800531 ...
#>  $ c_V2             : num  1558655 4623201 4822708 1675073 4845791 ...
#>  $ c_V3             : num  93387 689291 739431 104089 698241 ...
#>  $ VBR              : num  5266.1 37.6 44.5 5548.8 40 ...
#>  $ HNAperLNA        : num  0.4 1.162 1.305 0.167 1.489 ...
#>  $ ...20            : logi  NA NA NA NA NA NA ...
#>  $ ...21            : logi  NA NA NA NA NA NA ...
#>  $ ...22            : logi  NA NA NA NA NA NA ...
#>  $ ...23            : logi  NA NA NA NA NA NA ...
#>  $ ...24            : logi  NA NA NA NA NA NA ...
#>  $ ...25            : logi  NA NA NA NA NA NA ...
#>  $ ...26            : logi  NA NA NA NA NA NA ...
#>  $ ...27            : logi  NA NA NA NA NA NA ...
#>  $ ...28            : logi  NA NA NA NA NA NA ...
#>  $ ...29            : logi  NA NA NA NA NA NA ...
#>  $ ...30            : logi  NA NA NA NA NA NA ...
#>  $ ...31            : logi  NA NA NA NA NA NA ...
```

``` r
df <- new_viralprod_class(bad_dataframe)
#> Following populations will be analyzed: c_Bacteria, c_HNA, c_LNA, c_Viruses, c_V1, c_V2, c_V3
#> Error in new_viralprod_class(bad_dataframe): Assertion on 'has_correct_columns' failed: Must be TRUE.
class(bad_dataframe)
#> [1] "data.frame"
```

## Get started

To get started with the `viralprod` package and explore your data,
follow these steps:

- **Installation**: Make sure you have the `viralprod` package
  installed. If you havenâ€™t already, you can find installation
  instructions in the `main README file`.
- **Data Files**: Familiarize yourself with the two types of data files
  required for analysis. Make sure your own data files fulfill the
  requirements.
- **Package Usage**: You can use these data files in the `viralprod`
  package to calculate, analyze, and visualize viral production. More
  detailed explanations and examples are in the `package's vignette`.

## References

- Main README file:
  <https://github.com/mdhishamshaikh/ViralProduction_R/tree/rpkg>
- Packageâ€™s vignette:
  <https://github.com/mdhishamshaikh/ViralProduction_R/tree/rpkg/vignettes>
